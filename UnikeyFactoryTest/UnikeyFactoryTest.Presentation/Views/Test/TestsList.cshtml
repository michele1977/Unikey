@using System.Web.UI.WebControls
@using UnikeyFactoryTest.Service
@model  UnikeyFactoryTest.Presentation.Models.TestsListModel

@{
    ViewBag.Title = "TestsList";
}
<link href="~/Content/font-awesome.css" rel="stylesheet" />

<h2>Tests List</h2>

<script>
    function openModal(Id) {

        $('#mailModal').modal("show");
        document.getElementById("selectedTest").value = Id;

        document.getElementById("false").setAttribute("hidden", "hidden");
        document.getElementById("true").setAttribute("hidden", "hidden");
        document.getElementById("subject-name").value = null;
        document.getElementById("email-address").value = null;


    }
</script>

<div id="ErrorAlert" class="alert alert-danger" role="alert" style="display:none">
    <strong>Holy holy maccaroni!</strong> An error occurred while deleting the test
    <button type="button" class="close" aria-label="Close" onclick="closeErrorAlert()">
        <span aria-hidden="true">&times;</span>
    </button>
</div>

<hr />

<div>
    <form action="@Url.Action("TextSearch", "Test")" method="post">
        <div class="btn-group">
            <input id="searchinput" value="@Model.TextFilter" type="search" name="textFilter" class="form-control"
                   onsearch="@Url.Action("TestsList", "Test", new {TextFilter = ""})">
            <span id="searchclear" class="glyphicon glyphicon-remove-circle"></span>
            <input type="submit" class="btn btn-primary" value="Search" />
        </div>
    </form>
</div>

<div id="pageSizeDropDownList">
    @Html.Label("Elements per page")
    <select name="PageSizeSelection" onchange="resizePage(this.value, @Model.PageNumber, '/Test/TestsList?TextFilter=@Model.TextFilter&PageSize=');">
        <option value="@Model.PageSize" selected="selected">@Model.PageSize</option>
        @for (int i = 10; i <= 161; i *= 2)
        {
            if (Model.PageSize != i)
            {
                <option value="@i">@i</option>
            }

        }
    </select>
</div>

<table class="table">
    <tr>
        <th>Id</th>
        <th>Title</th>
        <th>Date</th>
        <th>URL</th>
        <th>Number of tests</th>
        <th>Number of tests opened</th>
        <th>Actions</th>
    </tr>
    <div id="myrender">

    </div>
    @foreach (var test in Model.Tests)
    {
        test.NumberOfTest = Model.AdministratedTestOpen.FirstOrDefault(x => x.Key == test.Id).Value;
        Html.RenderPartial("TestsTablePartial", test);
    }

</table>

<div class="modal fade" id="mailModal" tabindex="-1" role="dialog" aria-labelledby="mailModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="mailModalLabel">Send test with email</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <input type="text" hidden="hidden" id="selectedTest" />
                        <input required type="text" class="form-control" placeholder="example@mail.com" id="email-address">
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">Subject name:</label>
                        <input required type="text" class="form-control" id="subject-name">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" onclick="send()" class="btn btn-primary">Send email</button>
            </div>
            <div>
            </div>
            <div>
                <label hidden="hidden" id="true" style="text-align: right; color: green"> Sending successful</label>
            </div>
            <div>
                <label hidden="hidden" id="false" style="text-align: right;color: red">Not valid mail</label>
            </div>
        </div>
    </div>
</div>


<div>
    @if (Model.PageNumber > 1)
    {
        <a href="@Url.Action("TestsList","Test",new { PageNumber = 1, Model.PageSize, Model.TextFilter })"><i class="fa fa-angle-double-left btn" title="First"></i></a>
        <a href="@Url.Action("TestsList","Test",new { PageNumber = Model.PageNumber - 1, Model.PageSize, Model.TextFilter})"><i class="fa fa-arrow-left btn" title="Previous"></i></a>

    }
    <label>@Model.PageNumber of @Model.LastPage</label>
    @if (@Model.PageNumber != @Model.LastPage)
    {
        <a href="@Url.Action("TestsList","Test",new { PageNumber = Model.PageNumber + 1, Model.PageSize, Model.TextFilter})"><i class="fa fa-arrow-right btn" title="Next"></i></a>
        <a href="@Url.Action("TestsList","Test",new { PageNumber = Model.LastPage, Model.PageSize, Model.TextFilter})"><i class="fa fa-angle-double-right btn" title="Last"></i></a>

    }
</div>

